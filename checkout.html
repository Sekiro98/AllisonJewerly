<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout | Joa & Ali Jewelry</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .resumen-carrito {
      background: #ffff;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 0 18px rgba(0,0,0,0.59);
      margin-bottom: 2rem;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    .resumen-carrito ul {
      list-style: none;
      padding: 0;
      margin: 0 0 1.2rem 0;
    }
    .resumen-carrito li {
      border-bottom: 1px solid #eee;
      padding: 0.5rem 0;
      display: flex;
      justify-content: space-between;
      font-size: 1rem;
    }
    .resumen-carrito .total {
      font-size: 1.1rem;
      font-weight: bold;
      color: #d4af37;
    }
    .exito {
      background: #e7ffe7;
      border: 1px solid #7dce7d;
      color: #236723;
      padding: 1rem;
      border-radius: 10px;
      margin-top: 2rem;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      text-align: center;
    }
    /* Centrado Paypal */
    #paypal-button-container {
      margin-top: 1.5rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }
    @media (max-width: 700px) {
      #paypal-button-container {
        width: 100% !important;
        padding-left: 0;
        padding-right: 0;
      }
    }
    .floating-logo {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 70px;
      z-index: 1000;
      opacity: 0.90;
      border-radius: 12px;
      box-shadow: 0 0 14px rgba(0,0,0,0.20);
    }
  </style>
  <!-- PayPal SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=AW5CDt-CO4_oK_V4jqrXVNPWgeLzSJBtW9oOJrL4JnYZT4Bmt7B_BlkicjiwzrVvocC7cqIEyKa5zBKw&currency=USD"></script>
</head>
<body>
  <header>
    <h1>Finalizar Compra</h1>
    <nav>
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="catalogo.html">Catálogo</a></li>
        <li><a href="servicios.html">Servicios</a></li>
        <li><a href="galeria.html">Galería</a></li>
        <li><a href="contacto.html">Contacto</a></li>
      </ul>
    </nav>
  </header>
  <main>
    <section class="resumen-carrito" id="resumen-carrito">
      <h2>Resumen de tu pedido</h2>
      <ul id="checkout-lista"></ul>
      <p class="total">Total: $<span id="checkout-total"></span> USD</p>
    </section>
    <form id="formulario-checkout">
      <h2>Datos para la compra</h2>
      <label for="nombre">Nombre completo:</label>
      <input type="text" id="nombre" name="nombre" required />
      <label for="email">Correo electrónico:</label>
      <input type="email" id="email" name="email" required />
      <label for="direccion">Dirección de entrega:</label>
      <input type="text" id="direccion" name="direccion" required />
    </form>
    <!-- PayPal centrado -->
    <div style="display:flex; justify-content:center; align-items:center; width:100%; margin: 0 auto;">
      <div id="paypal-button-container"></div>
    </div>
    <div id="mensaje-exito" class="exito" style="display:none;">
      <h3>¡Gracias por tu compra!</h3>
      <p>Tu pedido ha sido recibido y el pago procesado con éxito. Pronto nos pondremos en contacto contigo.</p>
    </div>
  </main>
  <footer>
    <p>&copy; Joa & Ali Jewelry</p>
  </footer>
  <script>
    // Cargar carrito y mostrar resumen
    let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
    function mostrarCheckout() {
      let lista = document.getElementById('checkout-lista');
      let total = 0;
      lista.innerHTML = '';
      carrito.forEach(item => {
        total += item.precio * item.cantidad;
        lista.innerHTML += `<li>
          <span>${item.nombre} <strong>x${item.cantidad}</strong></span>
          <span>$${(item.precio * item.cantidad).toFixed(2)}</span>
        </li>`;
      });
      document.getElementById('checkout-total').textContent = total.toFixed(2);
      return total.toFixed(2);
    }
    mostrarCheckout();

    // PAYPAL BUTTON
    paypal.Buttons({
      style: {
        color: 'gold',
        shape: 'pill',
        label: 'pay',
        height: 40
      },
      createOrder: function(data, actions) {
        let total = mostrarCheckout();
        return actions.order.create({
          purchase_units: [{
            amount: {
              value: total
            },
            description: 'Compra en Joa & Ali Jewelry'
          }]
        });
      },
      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          document.getElementById('mensaje-exito').style.display = 'block';
          document.getElementById('formulario-checkout').style.display = 'none';
          document.getElementById('resumen-carrito').style.display = 'none';
          document.getElementById('paypal-button-container').style.display = 'none';
          localStorage.removeItem('carrito');
        });
      },
      onError: function(err) {
        alert('Ocurrió un error con el pago: ' + err);
      }
    }).render('#paypal-button-container');
  </script>
  <img src="img/logo.png" alt="Allison Jewelry Logo" class="floating-logo" />
</body>
</html>
